


<%- include('adminHead') %>



<body>
    <div class="container-scroller">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
          <a class="sidebar-brand brand-logo" href="index.html"><img src="/assetsuser/img/logo.png" alt="logo" /></a>
          <a class="sidebar-brand brand-logo-mini" href="index.html"><img src="/assets/images/logo-mini.svg" alt="logo" /></a>
        </div>
        <ul class="nav">
          <li class="nav-item profile">
            <div class="profile-desc">
              <div class="profile-pic">
                <div class="count-indicator">
                  <img class="img-xs rounded-circle " src="/assetsadmin/images/faces/face15.jpg" alt="">
                  <span class="count bg-success"></span>
                </div>
                <div class="profile-name">
                  <h5 class="mb-0 font-weight-normal">Admin</h5>
                </div>
              </div>
              <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
             
            </div>
          </li>
          <li class="nav-item nav-category">
            <span class="nav-link">Navigation</span>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="productmanagment" aria-expanded="false" aria-controls="ui-basic">
              <span class="menu-icon">
                <i class="mdi mdi-laptop"></i>
              </span>
              <span class="menu-title">Product Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="ordermanagment">
              <span class="menu-icon">
                <i class="mdi mdi-playlist-play"></i>
              </span>
              <span class="menu-title">Order Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="categorymanagment">
              <span class="menu-icon">
                <i class="mdi mdi-table-large"></i>
              </span>
              <span class="menu-title">Category Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="usermanagment">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
              <span class="menu-title">User Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="bannermanagment">
              <span class="menu-icon">
                <i class="mdi mdi-contacts"></i>
              </span>
              <span class="menu-title">Banner Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="coupunmanagment" aria-expanded="false" aria-controls="auth">
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">coupun Managment</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="/admin/salesReport" aria-expanded="false" aria-controls="auth">
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">Sales Report</span>
            </a>
          </li>
        </ul>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_navbar.html -->
        <nav class="navbar p-0 fixed-top d-flex flex-row">
          <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
            <a class="navbar-brand brand-logo-mini" href="index.html"><img src="/assets/images/logo-mini.svg" alt="logo" /></a>
          </div>
          <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
              <span class="mdi mdi-menu"></span>
            </button>
            <ul class="navbar-nav w-100">
              <li class="nav-item w-100">
                <h3 style="color: rgb(126, 126, 126); padding-top:15px; ">User Managment</h3>
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-right">
              <a href="/admin/logout" style="width:200px; height:40px; display: flex;justify-content: center; align-items: center;" class="add btn btn-primary todo-list-add-btn">Logout</a>
              <li class="nav-item dropdown">
                <a class="nav-link" id="profileDropdown" href="#" data-toggle="dropdown">
                  <div class="navbar-profile">
                    <img class="img-xs rounded-circle" src="/assetsadmin/images/faces/face15.jpg" alt="">
                    <p class="mb-0 d-none d-sm-block navbar-profile-name">Admin</p>
                    <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                  </div>
                </a>
              </li>
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
              <span class="mdi mdi-format-line-spacing"></span>
            </button>
          </div>
        </nav>
        <div class="main-panel" >
          <div class="content-wrapper" style="background-color: rgba(0, 0, 0, 0.473);">    
            
            <div>

                <h2>Filter</h2>
                <div class="container-fluid d-flex align-items-end tablesHeader">
                  <h6 >Filter by : </h6>
                  <a href="/admin/sales-report?filter=lastWeek" class="btn btn-<% if(filter!='lastWeek'){ %>outline-<% } %>light ml-3 ms-2">Last week</a>
                  <a href="/admin/sales-report?filter=lastMonth" class="btn btn-<% if(filter!='lastMonth'){ %>outline-<% } %>light ml-3 ms-2">Last month</a>
                  <a href="/admin/sales-report?filter=thisMonth" class="btn btn-<% if(filter!='thisMonth'){ %>outline-<% } %>light ml-3 ms-2">This Month</a>
                  <a href="/admin/sales-report?filter=lastYear" class="btn btn-<% if(filter!='lastYear'){ %>outline-<% } %>light ml-3 ms-2">Last Year</a>
                  <a href="/admin/sales-report?filter=thisYear" class="btn btn-<% if(filter!='thisYear'){ %>outline-<% } %>light ml-3 ms-2">This year</a>
                </div>
                <div class="container-fluid filter-head pt-4 tablesHeader">
                   <h6>Filter by date : </h6>
                  <form action="/admin/sales-report" class="d-flex" method="get">
                    <input type="date" class="form-control mr-3" name="startDate" value="<%= startDate %>" onchange="this.form.submit()">
                    to
                    <input type="date" class="form-control  ml-3" name="endDate" value="<%= endDate %>" onchange="this.form.submit()">
                  </form>
                </div>
                <div class="report-btns container-fluid tablesHeader">
                  <h3 class="mt-4 mb-3" >Sales Report</h3>
                  <div>
                    <button style="background-color: rgba(240, 248, 255, 0.836); color: black; border-radius:4px;" onclick="downloadExcel()" class="btn btn-dark mr-3">Download in Excel</button>
                    <button style="background-color: rgba(240, 248, 255, 0.788); color: black; border-radius:4px;" onclick="downloadPdf()" class="btn btn-dark">Download in PDF</button>
                  </div>
                </div>
                <div class="row mt-2 p-4">
                    <div class="orders-table w-100">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                  <th colspan="3" class="thead">Sales report (<%= startDate %> - <%= endDate %>)</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                    <th scope="col">Total Revenue</th>
                                    <td scope="col"><%= totalRevenue %> </td>
                                  </tr>
                                <tr>
                                    <th scope="col">Total Orders</th>
                                    <td scope="col"><%= totalOrders %> </td>
                                  </tr>
                                <tr>
                                    <th scope="col">Total Pending</th>
                                    <td scope="col"><%= totalPending %> </td>
                                  </tr>
                                <tr>
                                    <th scope="col">Total Delivered</th>
                                    <td scope="col"><%= totalDelivered %> </td>
                                  </tr>
                                <tr>
                                    <th scope="col">Total cancelled</th>
                                    <td scope="col"><%= totalCancelled %> </td>
                                  </tr>
                            </tbody>
                          </table>
                    </div>
                </div>
                
               
                
                <h3 class="mt-3 head3">Orders</h3>
                <div class="row mt-2 p-3">
                    <div class="orders-table w-100" id="content">
                      <div class="table-responsive">
                        <table class="table table-hover w-100" id="table">
                            <thead>
                                <tr>
                                  <th scope="col">No</th>
                                  <th scope="col">Name</th>
                                  <th scope="col">date</th>
                                  <th scope="col">Payment Status</th>
                                  <th scope="col">Status</th>
                                  <th scope="col">Quantity</th>
                                  <th scope="col">Total</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                                <% orders.forEach((item,index)=>{ %>
            
                                <tr>
                                  <th scope="row"><%= index+1 %></th>

                                  <th scope="row">
                                    <a href="/admin/admin-view-order/<%=item._id%>"><%=item.orderItems.name %></a>
                                  </th> 

                                  <td><%=item.createdAt.toLocaleDateString() %></td>

                                  <td>
                                    <% if(item.paid || item.status == "delivered"){ %> Paid
                                    <% }else{ %> Not Paid <% } %> 
                                    </td>
                                  <td class="d-flex justify-content-center align-items-center h-100">
                                    <div>
            
                                      <div class="del-status <%= item.status  %> ">
                                        <%= item.status  %> 
                                      </div>
                                    </div>
                                </td>
                                  
                                <td><%=item.quantity  %> </td>
                                  <td><%=item.totalPrice%> </td>
                                </tr>
                                <%}) %> 
            
                                
                              </tbody>
                          </table>
                          </div>
                    </div>
                </div>
    
            </div>
            
          
            
            
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Copyright Â© bootstrapdash.com 2020</span>
              <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> Free <a href="https://www.bootstrapdash.com/bootstrap-admin-template/" target="_blank">Bootstrap admin templates</a> from Bootstrapdash.com</span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        

    

        


         
          
          

          
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.1/xlsx.full.min.js"></script>
  <script>
    
    let totalDelivered = '<%= totalDelivered%>'
    let totalOrders= '<%= totalOrders%>'
    let totalRevenue= '<%= totalRevenue%>'
    let totalPending= '<%= totalPending%>'
    let totalCancelled= '<%= totalCancelled%>'
    let startDate= '<%= startDate%>'
    let endDate= '<%= endDate%>'
    
   
    
    orders=JSON.parse(orders);
    categories=JSON.parse(categories);
    
    categoryBody= categories.map(item=>{
      return [item.category, item.count, item.profit]
    })
   

    function downloadPdf() {
      const { jsPDF } = window.jspdf;
      const doc= new jsPDF();
      let salesReportHead='('+startDate+" - "+endDate+")"
      doc.text(15, 20, "P-Mart Sales Report ");
      doc.text(15, 30, salesReportHead);
      doc.autoTable({
        head: [['Type', 'Details']],
        body: [
              ['Total Orders', totalOrders],
              ['Total Revenue',"RS/"+totalRevenue],
              ['Total Pending', totalPending],
              ['Total Delivered', totalDelivered],
              ['Total Cancelled', totalCancelled],
              ],
        startY: 40
      })
      

     

      doc.save('sales-report('+startDate+' - '+endDate+').pdf');
    }
    function downloadExcel(){
      let report=[
        {type:"Total Revenue", value:totalRevenue},
        {type:"Total Orders", value:totalOrders},
        {type:"Total Pending", value:totalPending},
        {type:"Total Delivered", value:totalDelivered},
      ]

        var sheet1 = XLSX.utils.json_to_sheet(report);
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, sheet1, "Sales Report");

        XLSX.writeFile(wb,'sales-report.xlsx');
    }
  </script>
  </body>
  
  <%- include('footer') %>

